\subsection{Event selection}
\label{sec:selection}

Initial event selection is outlined in table~\ref{lab:eventsel}. This is primarily designed to remove problematic and background events in favour of the $(Z\to\mu\mu)$+jets signal process. The various cuts are discussed in more detail below.

\begin{table}[h!]
    \centering
    \begin{tabular}{l|l}
         \hline
    \textbf{Event Selection} & \textbf{Description} \\ \hline
    Good Runs List & Event must be part of GRL \\ \hline
    Event Cleaning & No LAr, tile calorimeter, or tracker errors. Event is complete. \\ \hline
    Trigger & Single muon trigger: \\
    & \texttt{HLT\_mu20\_iloose\_L1MU15\_OR\_HLT\_mu50} (2015) \\
    & \texttt{HLT\_mu26\_ivarmedium\_OR\_HLT\_mu50} (2016-18) \\ \hline
    Primary Vertex & $N_{\text{PV}}\geq1$ \\ \hline
    Muons & $N_{\text{muons}}\geq2$ \\
          & Opposite charges \\
          & Pass TTVA recommendations for muons \\
          & $81\leq m_{\ell\ell} (\text{GeV})\leq 101$ \\
          & $p_{\text{T},\ell\ell}\geq200$ GeV \\ \hline
    \end{tabular}
    \caption{Overview of the applied event selection.}
    \label{lab:eventsel}
\end{table}

\subsubsection{Event requirements}
The first requirement is that the event must be a part of the ATLAS Good Run Lists (GRL). These are discussed in section~\ref{sec:samples}.

Secondly, the events must pass event cleaning\footnote{The event cleaning procedure is outlined in \url{twiki: https://twiki.cern.ch/twiki/bin/view/Atlas/DataPreparationCheckListForPhysicsAnalysis}}. This removes events that:
\begin{itemize}
    \setlength{\itemsep}{1pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
    \item Contain errors in the data collected in the LAr calorimeters (check for error on \texttt{xAOD::EventInfo::LAr})
    \item Contain errors in the data collected in the tile calorimeters (check for error on \texttt{xAOD::EventInfo::Tile})
    \item Contain errors in the silicon tracker data (check for error on \texttt{xAOD::EventInfo::SCT})
    \item Are incomplete due to a restart of the trigger, timing and control system (check for event flag in \texttt{xAOD::EventInfo::Core})
    \item Fail the Loose event cleaning requirement (\texttt{DFCommonJets\_eventClean\_LooseBad}). This is also applied to MC samples.
\end{itemize}

Additionally, it is required that the event in question have at least one primary vertex.

\subsubsection{Trigger requirements}
\label{subsubsec:trigger}
Events are required to pass an unprescaled single muon trigger\footnote{The muon trigger recommendations can be found here: \url{twiki: https://twiki.cern.ch/twiki/bin/view/Atlas/MuonTriggerPhysicsRecommendationsRel212017}}, as outlined in table~\ref{lab:eventsel}.
The recommended trigger is dependent on the year in which the data was taken (or the year of the corresponding Monte Carlo sample).

\subsubsection{Dimuon system requirements}
\label{subsubsec:TTVA_selection}
The event is required to have at least two muons of opposite charge, with a dilepton mass between 81 GeV and 101 GeV in order to ensure the muons originate from a $Z$ boson.

Additionally, the muons must pass track-to-vertex association recommendations\footnote{Recommendations are given by the tracking group and are outlined here: \url{twiki: https://twiki.cern.ch/twiki/bin/view/AtlasProtected/TrackingCPEOYE2015}} as follows:

\begin{itemize}
    \item $|d_0^{\text{BL}}\text{significance}| < $ 3
    \item $|\Delta z_0^{\text{BL}}\sin\theta| < 0.5 $mm
\end{itemize}

and BL stands for beamline, and $d_0$ and $z_0$ represent the point along the track with the closest approach to the beamspot.

The large $p_{\text{T},\ell\ell}$ cut of 200~GeV has been chosen to reduce the overall dataset and to focus on events in which the balancing jet(s) have a high quantity of charged particles, as these are the primary subject of the analysis.
Events with a $p_{\text{T},\ell\ell}$ larger than 165~GeV are saved in order to study migration effects between truth and reconstructed events (i.e. events where the reconstructed $p_{\text{T},\ell\ell}$
is smaller than 200 GeV, but is larger than 200 GeV at truth level and vice versa).

\subsection{Detector-level objects}

\paragraph{Muons} are reconstructed using a combination of information from the muon spectrometer (MS) and the inner detector (ID). Occasionally, the ATLAS calorimeters are used to provide additional information for reconstruction. The reconstruction process is described in detail in reference~\cite{Aad:2016jkr}.
The muons are required to pass Medium quality selection using the \texttt{MuonSelectionTool}\footnote{The twiki detailing the MuonSelectionTool: \url{twiki: https://twiki.cern.ch/twiki/bin/view/Atlas/MuonSelectionToolR21}} and the \texttt{PflowLoose\_VarRad} isolation working point as given by
the \texttt{IsolationTool}\footnote{Information on the isolations WPs and the tool: \url{twiki: https://twiki.cern.ch/twiki/bin/view/AtlasProtected/RecommendedIsolationWPs}}. The simulated muons are also calibrated in order to correct for $p_\text{T}$ discrepancies between data and simulation~\cite{Aad:2016jkr}.
Kinematically, muons are required to have a minimum $\pt$ of 25~GeV, and have $|\eta|<2.4$.

\paragraph{Tracks} are reconstructed from charged-particle hits within the silicon- and straw-tube based inner tracking detectors. They are required to pass the Loose quality working point and to be associated with the primary vertex of the event using the Tight track-to-vertex association\footnote{Information on both the selection tool and the TTVA tool may be found here: \url{twiki: https://twiki.cern.ch/twiki/bin/view/AtlasProtected/TrackingCPRecsRun2Final}} (see appendix~\ref{app:jetcomp}).
The primary vertex is defined as the reconstructed vertex with the highest sum of associated track $\pt^2$. Tracks are required to have a $\pt>500$~\MeV~ and to not have originated from a muon to be included in this measurement.  The track $\eta$ and $\phi$ coordinates come from the five-parameter track fit to $(\eta,\phi,q/p,d_0,z_0)$, and thus correspond to the track coordinates at the origin.
In addition, tracks which are associated with the muons are not considered part of the final track collection.

\paragraph{Track jets} are reconstructed using the anti-$k_t$ algorithm~\cite{Cacciari:2008gp} with a radius parameter of $R=0.4$. All tracks that pass the selection described above are used as input, and clustering is completed using \textsc{FastJet}~\cite{Cacciari:2011ma}.

\paragraph{Jets (saved in Ntuples, but not used in the analysis)} are also reconstructed using the anti-$k_t$ algorithm with a radius parameter of $R=0.4$. Particle flow objects~\cite{Aaboud:2017aca} are used as input. The jets are calibrated using the recommended procedure for small-$R$ jets, this includes: MCJES calibration, global sequential calibration, and in-situ calibration.
Jets are required to have a calibrated $p_\text{T} > 20~\text{GeV}$ and rapidity $|y| < 4.4$\footnote{General recommendations are found here: \url{twiki: https://twiki.cern.ch/twiki/bin/view/AtlasProtected/JetEtmissRecommendationsR21}}.

\subsubsection{Overlap removal}

As mentioned above, the PFlow jets are not currently being used as part of the analysis so the overlap removal described below will not have an effect on results.

There is a possibility that an electron may be misidentified as a jet during reconstruction, so in cases where the jet is found to be within $\Delta R < 0.2$ of a reconstructed electron, the jet is removed.
Additionally, a specialized overlap removal procedure must be applied between muons and jets due to a bug in the particle flow algorithm which results in sub-leading muon tracks being included in the particle flow objects~\footnote{A brief summary of the bug and the overlap removal procedure can be found here: \url{https://indico.cern.ch/event/807799/contributions/3362328/attachments/1818680/2973610/Presentation.pdf},
and here: \url{https://indico.cern.ch/event/814156/contributions/3396841/attachments/1830226/2997072/Presentation.pdf}}.
The muon is preferentially kept in this case, so it does not limit our analysis as the jets are not currently used.

A summary of the detector level event selection can be found in table~\ref{tab:ObjCuts}.


\begin{table}[h!]
    \centering
    \begin{tabular}{l|l}
    \hline
     \textbf{Object} & \textbf{Additional selection criteria} \\ \hline
     Muons & $\pt>25~\GeV$, $|\eta|<2.4$ \\
           & Medium quality, pass isolation \texttt{PflowLoose\_VarRad} \\ \hline
     Jets (\texttt{AntiKt4EMPFlowJets}) & $\pt>20~\GeV$, $|y|<4.4$ \\
                                        & $\Delta R_{e,jet} > 0.2$ \\
                                        & Muon-PFlow jet overlap removal \\ \hline
     Tracks & $p_{\text{T}} > 500$ MeV \\
            & Loose Quality \\
            & Tight TTVA \\
            & Do not originate from a muon \\ \hline
     Track Jets & Input tracks must pass the above cuts \\ \hline
    \end{tabular}
    \caption{Object level cuts}
    \label{tab:ObjCuts}
\end{table}

\subsection{Particle-level objects}

Stable charged particles ($c\tau$ > 10 mm) are used to define the analog of tracks at particle-level. Charged-particles are required to have $\pt > 500$~\MeV~and $|\eta|<2.5$.
Muons are dressed using all photons within a radius of $R=0.1$ and identical kinematic cuts are applied to those used at the detector-level.
An analogue to the \texttt{TruthWZJets} collection is utilized at the particle-level. Jets are constructed utilizing the anti-$k_t$ algorithm with $R=0.4$ from all particle 4-vectors except for prompt leptons from $W$, $Z$, Higgs, and $\tau$ decay, and photons within a cone of $R=0.1$ around the prompt lepton.
Track jets at the particle-level are constructed using the same process as at the detector-level, but the charged particles are used as input.
Objects at particle-level, as well as the truth phase space, are summarized in table~\ref{tab:PLObjCuts}.

\begin{table}[h!]
    \centering
    \begin{tabular}{l|l}
    \hline
    \textbf{Object} & \textbf{Selection} \\ \hline
    Dressed muons & $p_\text{T} > 25$ GeV, $|\eta| < 2.4$ \\\hline
    Jets (\texttt{TruthWZJets}) & $p_\text{T} > 10$ GeV, $|y|<4.4$ \\\hline
    Charged hadrons & $p_\text{T}>500$ MeV, $|\eta|<2.5$  \\ \hline
    Track jets & Charged hadrons used as input must pass above criteria \\ \hline
    Fiducial volume & At least two oppositely charged muons \\
    & $81<m_{\ell\ell}~\GeV<101$ \\
    & $p_{\text{T},\ell\ell}>200$ GeV \\ \hline
    \end{tabular}
    \caption{Fiducial object cuts and the truth phase space}
    \label{tab:PLObjCuts}
\end{table}

\subsection{Corrections to Monte Carlo samples}
\label{subsec:MCCorr}
\subsubsection{Pileup reweighting}
\label{subsec:PRW}
%When events in MC samples are produced, the interactions per bunch crossing, $\mu$, is assigned a certain value. This can differ from the values that are actually seen in the corresponding data, thus it is
%necessary to correct the MC events such that the distribution of $\mu$ is equivalent to what is observed in data.
When a given MC event is produced, the average interactions per bunch crossing, $\mu$, is an assigned parameter that determines how many pileup interactions are to be overlaid.
It is important that the pileup modeling of the simulated samples correspond to data, therefore each MC event is assigned an event weight such that the $\mu$ distributions agree.

The \texttt{PileupReweightingTool}\footnote{Details can be found here: \url{twiki: https://twiki.cern.ch/twiki/bin/view/AtlasProtected/ExtendedPileupReweighting}} uses the $\mu$ and the MC event along with the luminosity of the corresponding data in the same run number to determine the pileup weight to be applied to the event.
This requires that both the $\mu$ distribution for the specific MC sample is available to the tool, as well as the files used to calculate the luminosity for the data. As we use unprescaled triggers in this analysis, the centrally produced lumicalc files corresponding to the GoodRunsLists in section~\ref{subsec:data} are used.
Configuration files for the tool for each MC sample are also provided centrally.
The pileup weight is then multiplied with the MC event weight in order to correct the $\mu$.

The tool also provides a scaling correction for data. The pileup simulation for a given $\mu$ value is known to be too hard, therefore the $\mu$ distribution of the dataset is shifted towards lower values to account for this.

\subsubsection{Trigger scale factor}
There are differing trigger efficiencies between data and MC simulation, thus a correction in the form of a scale factor applied to the event weight is necessary for MC events. The triggers used in this analysis are outlined in section~\ref{subsubsec:trigger}.

\subsubsection{Muon scale factors}
Muon scale factors related to reconstruction efficiency, isolation efficiency, and track-to-vertex (TTVA) efficiency are derived from $J/\psi$ and $Z$ events using the tag-and-probe method for muons in the central region. The resulting scale factors are applied to the event weight in the same way as the trigger scale
factor\footnote{Addtional information on both the trigger and muon scale factors may be found in the muon analysis twiki: \url{twiki: https://twiki.cern.ch/twiki/bin/view/AtlasProtected/MCPAnalysisGuidelinesMC16}}.
